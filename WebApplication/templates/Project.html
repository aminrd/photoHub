{% extends 'base.html' %}
{% load static %}
{% block STYLESHEETS %}
    <link href={% static "lib/image-slider/css/twentytwenty.css" %} rel="stylesheet">
    <script src={% static "lib/chart-master/Chart.js" %}></script>
{% endblock %}

{% block MAIN_CONTENT %}
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-9 main-chart">
            <!--CUSTOM CHART START -->
            <div class="border-head">
              <h3>Photo {% if PROJECT.status is not 'finished' %}(not edited yet){% endif %}</h3>
            </div>
            <div class="custom-bar-chart">
                <div class="twentytwenty-container">
                          <img src="{{ PROJECT.input_image.url }}" style="height: 450px; width: 100%; object-fit: cover;">
                          <img src="{{ PROJECT.output_image.url }}" style="height: 450px; width: 100%; object-fit: cover;">
                </div>
            </div>
            <div class="row" style="margin-top: 200px;">
              <!-- WEATHER PANEL -->
              <div class="col-md-4 col-sm-4 mb">
                <div class="darkblue-panel pn">
                  <div class="darkblue-header">
                    <h5>Edit deadline</h5>
                  </div>
                  <canvas id="serverstatus02" height="120" width="120"></canvas>
                    {% if PROJECT.days_remaining >= 0%}
                          <script>
                            var doughnutData = [{
                                value: {{ PROJECT.days_remaining }},
                                color: "#1c9ca7"
                              },
                              {
                                value: {{ PROJECT.total_days }} - {{ PROJECT.days_remaining }},
                                color: "#f68275"
                              }
                            ];
                            var myDoughnut = new Chart(document.getElementById("serverstatus02").getContext("2d")).Doughnut(doughnutData);
                          </script>
                    {% else %}
                      <script>
                            var doughnutData = [{
                                value: 1,
                                color: "#F88"
                              }
                            ];
                            var myDoughnut = new Chart(document.getElementById("serverstatus02").getContext("2d")).Doughnut(doughnutData);
                          </script>
                    {% endif %}
                  <p class="text-warning">{{ PROJECT.target_deadline }}</p>
                  <footer>
                    <div class="pull-left">
                    {% if PROJECT.days_remaining >= 0%}
                      <h5><i class="fa fa-hdd-o"></i>{{ PROJECT.days_remaining }} days remaining</h5>
                    {% else %}
                        <h5><i class="fa fa-hdd-o"></i>Deadline passed</h5>
                    {% endif %}
                    </div>
                  </footer>
                </div>
                <!--  /darkblue panel -->
              </div>
              <!-- /col-md-4-->
              <!-- DIRECT MESSAGE PANEL -->
              <div class="col-md-8 mb">
                <div class="message-p pn">
                  <div class="message-header">
                    <h5>Request description</h5>
                  </div>
                  <div class="row">
                    <div class="col-md-3 centered hidden-sm hidden-xs">
                      <img src="{{ PROJECT.client.get_profile_thumbnail }}" class="img-circl rounded-circle" width="65">
                    </div>
                    <div class="col-md-9">
                      <p>
                        <name>{{ PROJECT.client.default_user.first_name }} {{ PROJECT.client.default_user.last_name }}</name>
                        request
                      </p>
                      <p class="small">{{ PROJECT.date_created }}</p>
                      <p class="message">{{ PROJECT.description }}</p>
                    </div>
                  </div>
                </div>
                <!-- /Message Panel-->
              </div>
              <!-- /col-md-8  -->
            </div>

          {% if user == PROJECT.client.default_user or user == PROJECT.server.default_user %}
            <div class="row">
              <div class="col-lg-4 col-md-4 col-sm-4 mb">
                <div class="product-panel-2 pn">
                {% if PROJECT.status != 'finished' %}
                    <div class="badge badge-hot">Final</div>
                {% endif %}
                  <i class="fas fa-download fa-8x"></i>
                  <h5 class="mt">Download edit content</h5>
                  <h6>TOTAL SIZE: 1388</h6>
                <a href="#" class="btn btn-small btn-theme04" role="button" aria-pressed="true"><i class="fas fa-download"></i> Download</a>
                </div>
              </div>
              <!-- /col-md-4 -->
                {% if user == PROJECT.server.default_user and PROJECT.status == 'progress'%}
                      <div class="col-md-4 col-sm-4 mb">
                        <div class="green-panel pn">
                          <div class="green-header">
                            <h5>Submit</h5>
                          </div>
                            <br>
                        <a href="#" class="btn btn-theme03 btn-xl active" style="margin-bottom: 25px;" role="button" aria-pressed="true"><i class="fas fa-upload"></i> upload panel</a>
                            <br>
                          <h3>Upload files</h3>
                        </div>
                      </div>
                {% endif %}
              <!-- /col-md-4 -->
            </div>
          {% endif %}
            <!-- /row -->
          </div>

          <!-- /col-lg-9 END SECTION MIDDLE -->
          <!-- **********************************************************************************************************************************************************
              RIGHT SIDEBAR CONTENT
              *********************************************************************************************************************************************************** -->
          <div class="col-lg-3 ds">
            <!--COMPLETED ACTIONS DONUTS CHART-->
            <div class="donut-main">
              <h4>User</h4>
                <img class="img-responsive rounded-circle img-thumbnail" src="{{ PROJECT.client.get_profile_thumbnail }}" width="150" height="150" alt="{{ PROJECT.client.default_user.first_name }}-image">
                <br>
                <span>{{ PROJECT.client.default_user.first_name }}</span>
            </div>

            <h4 class="centered mt">
                Request status:
                {% if PROJECT.status == 'open' %}
                    <div class="btn btn-round btn-success btn-sm">Open</div>
                {% elif PROJECT.status == 'progress' %}
                    <div class="btn btn-round btn-warning btn-sm">Being edited</div>
                {% else %}
                    <div class="btn btn-round btn-primary btn-sm">Finished</div>
                {% endif %}
            </h4>

          {% if PROJECT.status == 'open' %}
              {% if USER_INFO.role == 'designer' and USER_INFO not in PROJECT.applicants.all%}
              <h4 class="centered mt">
              <button type="button" class="btn btn-round btn-warning" id="apply">Apply to edit</button>
                  <form id="application_form" method="POST" action="/project/{{ PROJECT.id }}/">
                      {% csrf_token %}
                      <input type="hidden" name="type" value="applicant_form">
                      <input type="hidden" name="applicant_id" value="{{ USER_INFO.default_user.id }}">
                  </form>
              </h4>
              {% endif %}
              <h4 class="centered mt">RECENT APPLICANTS</h4>
              {% for app in PROJECT.get_applicants %}
                <div class="desc">
                  <div class="thumb">
                    <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                  </div>
                  <div class="details">
                    <p>
                      <muted> {% for l in app.get_level_range %}<i class="far fa-circle"></i>{% endfor %}</muted>
                      <br/>
                      <a href="/profile/{{ app.default_user.id }}/">{{ app.default_user.first_name }}</a> is ready to edit this photo<br/>
                    </p>
                  </div>
                </div>
              {% endfor %}
          {% elif PROJECT.status == 'progress' %}
              <h4 class="centered mt">EDITOR</h4>
                <div class="desc">
                  <div class="thumb">
                    <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                  </div>
                  <div class="details">
                    <p>
                      <muted> {% for l in PROJECT.server.get_level_range %}<i class="far fa-circle"></i>{% endfor %}</muted>
                      <br/>
                      <a href="/profile/{{ PROJECT.server.default_user.id }}/">{{ PROJECT.server.default_user.first_name }}</a> is editing this photo<br/>
                    </p>
                  </div>
                </div>

          {% elif PROJECT.status == 'finished' %}
              <h4 class="centered mt">EDITOR</h4>
                <div class="desc">
                  <div class="thumb">
                    <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                  </div>
                  <div class="details">
                    <p>
                      <muted> {% for l in PROJECT.server.get_level_range %}<i class="far fa-circle"></i>{% endfor %}</muted>
                      <br/>
                      <a href="/profile/{{ PROJECT.server.default_user.id }}/">{{ PROJECT.server.default_user.first_name }}</a> edited this photo<br/>
                    </p>
                  </div>
                </div>

          {% endif %}

            <!-- / calendar -->
          </div>
          <!-- /col-lg-3 -->
        </div>
        <!-- /row -->
      </section>
{% endblock %}


{% block SCRIPTS %}
<script src={% static "lib/image-slider/js/jquery.event.move.js" %}></script>
<script src={% static "lib/image-slider/js/jquery.twentytwenty.js" %}></script>
<script>$(function(){$(".twentytwenty-container").twentytwenty();});</script>
<script src={% static "lib/sweetalert/sweetalert2.all.min.js" %}></script>

{% if USER_INFO.role == 'designer' and USER_INFO not in PROJECT.applicants.all%}
<script>
const swalWithBootstrapButtons = Swal.mixin({
  customClass: {
    confirmButton: 'btn btn-success',
    cancelButton: 'btn btn-danger'
  },
  buttonsStyling: false
});


document.getElementById('apply').onclick = function () {
    swalWithBootstrapButtons.fire({
      title: 'Are you sure?',
      text: "You are not able to withdraw from an application",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, continue!',
      cancelButtonText: 'No, cancel!',
      reverseButtons: true
    }).then((result) => {
      if (result.value) {
          // submit application:
        swalWithBootstrapButtons.fire(
          'Submitted',
          'You have been added to the list',
          'success'
        )
      document.getElementById('application_form').submit();
      } else if (
        /* Read more about handling dismissals below */
        result.dismiss === Swal.DismissReason.cancel
      ) {
        swalWithBootstrapButtons.fire(
          'Cancelled',
          'Review other requests',
          'error'
        )
      }
    });
}
</script>
{% endif %}
{% endblock %}